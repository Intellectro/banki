"use strict";
jQuery(function (r) {
    r(document).ready(function () {
        (window.q2.smartSearch = {
            smartSearchInit: function (t, s) {
                var a = new List(t, {
                        valueNames: s,
                        fuzzySearch: {
                            searchClass: "fuzzy-search",
                            location: 0,
                            distance: 100,
                            threshold: 0.2,
                            multiSearch: !0,
                        },
                    }),
                    e = !1,
                    s =
                        (a.on("updated", function () {
                            var t,
                                s = a.listContainer.attributes.id.nodeValue;
                            a.searched && a.visibleItems.length
                                ? (0 == e &&
                                      (r("#" + s + " .js-smart-search-list")
                                          .attr("aria-hidden", "false")
                                          .show(),
                                      r("#" + s + " .fuzzy-search").attr(
                                          "aria-expanded",
                                          "true"
                                      ),
                                      r(
                                          "#" + s + " .js-smart-search-list a"
                                      ).show()),
                                  (e = !1),
                                  (t = 0),
                                  r.each(
                                      r("#" + s + " .js-smart-search-list a"),
                                      function () {
                                          8 <= t
                                              ? (r(this).hide(),
                                                r(
                                                    "#" +
                                                        s +
                                                        " .js-smart-search-list .last-term"
                                                ).off("keydown"),
                                                r(this).removeClass(
                                                    "is-visible last-term"
                                                ),
                                                r(this)
                                                    .parent("li")
                                                    .removeClass(
                                                        "children-visible"
                                                    ))
                                              : (r(
                                                    "#" +
                                                        s +
                                                        " .js-smart-search-list .last-term"
                                                ).off("keydown"),
                                                r(this)
                                                    .addClass("is-visible")
                                                    .removeClass("last-term")),
                                              t++,
                                              r(
                                                  "#" +
                                                      s +
                                                      " .js-smart-search-list a.is-visible"
                                              )
                                                  .parent("li")
                                                  .addClass("children-visible");
                                      }
                                  ),
                                  r(
                                      "#" +
                                          s +
                                          " .js-smart-search-list li.children-visible:last a.is-visible:first"
                                  ).addClass("first-term"),
                                  r(
                                      "#" +
                                          s +
                                          " .js-smart-search-list li.children-visible:last a.is-visible:last"
                                  ).addClass("last-term"),
                                  r(
                                      "#" +
                                          s +
                                          " .js-smart-search-list .first-term"
                                  ).keydown(function (t) {
                                      t.shiftKey &&
                                          "Tab" === t.key &&
                                          setTimeout(function () {
                                              r(
                                                  "#" + s + " .fuzzy-search"
                                              ).focus(),
                                                  r(
                                                      "#" + s + " .fuzzy-search"
                                                  ).attr(
                                                      "aria-expanded",
                                                      "false"
                                                  ),
                                                  r(
                                                      "#" +
                                                          s +
                                                          " .js-smart-search-list"
                                                  )
                                                      .attr(
                                                          "aria-hidden",
                                                          "true"
                                                      )
                                                      .hide(),
                                                  (e = !0);
                                          }, 1);
                                  }),
                                  r(
                                      "#" +
                                          s +
                                          " .js-smart-search-list .last-term"
                                  ).keydown(function (t) {
                                      t.shiftKey ||
                                          "Tab" !== t.key ||
                                          setTimeout(function () {
                                              r(
                                                  "#" + s + " .fuzzy-search"
                                              ).focus(),
                                                  r(
                                                      "#" + s + " .fuzzy-search"
                                                  ).attr(
                                                      "aria-expanded",
                                                      "false"
                                                  ),
                                                  r(
                                                      "#" +
                                                          s +
                                                          " .js-smart-search-list"
                                                  )
                                                      .attr(
                                                          "aria-hidden",
                                                          "true"
                                                      )
                                                      .hide(),
                                                  (e = !0);
                                          }, 1);
                                  }))
                                : (r("#" + s + " .js-smart-search-list")
                                      .attr("aria-hidden", "true")
                                      .hide(),
                                  r("#" + s + " .fuzzy-search").attr(
                                      "aria-expanded",
                                      "false"
                                  ));
                        }),
                        r("#" + t).find("input[type=search]").length
                            ? r("#" + t).find("input[type=search]")
                            : r("#" + t).find("input[type=text]"));
                s.on("focusin", function () {
                    var t = a.listContainer.attributes.id.nodeValue;
                    a.searched &&
                        0 == e &&
                        (r("#" + t + " .js-smart-search-list")
                            .attr("aria-hidden", "false")
                            .show(),
                        r("#" + t + " .fuzzy-search").attr(
                            "aria-expanded",
                            "true"
                        ),
                        r("#" + t + " .js-smart-search-list a").show()),
                        (e = !1);
                }),
                    s.on("focusout", function () {
                        setTimeout(function () {
                            var t = a.listContainer.attributes.id.nodeValue;
                            r("#" + t + " .js-smart-search-list a:focus")
                                .length ||
                                (r("#" + t + " .js-smart-search-list")
                                    .attr("aria-hidden", "true")
                                    .hide(),
                                r("#" + t + " .fuzzy-search").attr(
                                    "aria-expanded",
                                    "false"
                                ));
                        }, 150);
                    });
            },
            formatList: function () {
                var e = ["term0"],
                    a =
                        (r.each(r(".js-smart-search-list > li"), function () {
                            var t = 0,
                                s =
                                    (r(this)
                                        .find("> a")
                                        .addClass("term" + t),
                                    r(this).find("> ul > li > a").clone()),
                                a =
                                    (r(this).find("> ul").remove(),
                                    r(this)
                                        .closest("li")
                                        .find("> a")
                                        .attr("href"));
                            r.each(s, function () {
                                t++,
                                    "#" == r(this).attr("href") &&
                                        r(this).attr("href", a),
                                    r(this).addClass("term" + t),
                                    e.push("term" + t);
                            }),
                                r(this).append(s);
                        }),
                        []);
                return (
                    r.each(e, function (t, s) {
                        -1 == r.inArray(s, a) && a.push(s);
                    }),
                    a
                );
            },
            init: function (a) {
                var e = 1,
                    t = r.parseHTML(
                        r.trim(drupalSettings.q2_smart_search_list["#template"])
                    ),
                    i =
                        ((t[0].className =
                            "js-smart-search-list q2-smart-search-list list"),
                        t[0].children.length && a.append(t),
                        window.q2.smartSearch.formatList());
                r.each(a, function () {
                    var t,
                        s = this;
                    r(this).find(".js-smart-search-list").length &&
                        ((t = "smart-search-form-" + e),
                        r(this).attr("id", t),
                        r(this).addClass(
                            "js-smart-search-form q2-smart-search-form"
                        ),
                        (r(this).find("input[type=search]").length
                            ? (r(this)
                                  .find("input[type=search]")
                                  .attr({
                                      autocomplete: "off",
                                      "aria-expanded": "false",
                                  }),
                              r(this).find("input[type=search]"))
                            : (r(this)
                                  .find("input[type=text]")
                                  .attr({
                                      autocomplete: "off",
                                      "aria-expanded": "false",
                                  }),
                              r(this).find("input[type=text]"))
                        ).addClass("fuzzy-search"),
                        window.q2.smartSearch.smartSearchInit(t, i)),
                        r(this)
                            .find(".fuzzy-search")
                            .keydown(function (t) {
                                !r(s)
                                    .parent(a)
                                    .find(
                                        ".js-smart-search-list:visible > li > a"
                                    ).length ||
                                    t.shiftKey ||
                                    "Tab" !== t.key ||
                                    setTimeout(function () {
                                        r(s)
                                            .parent(a)
                                            .find(
                                                ".js-smart-search-list li:first-of-type a:first-of-type"
                                            )
                                            .focus();
                                    }, 1);
                            }),
                        e++;
                });
            },
        }),
            Foundation.MediaQuery.is("small up") &&
                setTimeout(function () {
                    var t = r('form[action^="/search"]');
                    t.length && window.q2.smartSearch.init(t);
                }, 50);
    });
});
