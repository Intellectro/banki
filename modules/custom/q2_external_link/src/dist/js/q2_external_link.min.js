"use strict";
jQuery(function (a) {
    a(document).ready(function () {
        (window.q2.externalLinks = {
            hasFoundation: function () {
                if ("undefined" != typeof Foundation) {
                    var e = Foundation.version.length
                        ? -(Foundation.version.length - 1)
                        : 0;
                    return 6 <= Foundation.version.slice(0, e);
                }
            },
            showModal: function (e) {
                e = e.closest("a").attr("href");
                a("#q2_external_link_message .q2-external-link-url").text(e),
                    a(
                        "#q2_external_link_message .q2-external-link-continue"
                    ).attr("href", e),
                    a("#q2_external_link_message").attr("aria-hidden", "false"),
                    a(".q2-external-modal-overlay").toggle(),
                    setTimeout(function () {
                        a(
                            "#q2_external_link_message .button.q2-external-link-cancel"
                        ).focus();
                    }, 0);
            },
            hideModal: function () {
                a("#q2_external_link_message").attr("aria-hidden", "true"),
                    a(".q2-external-modal-overlay").toggle();
            },
            setupModal: function () {
                var e;
                this.hasFoundation()
                    ? a(
                          "#q2_external_link_message .button.q2-external-link-cancel"
                      ).on("click", function (e) {
                          e.preventDefault(),
                              a("#q2_external_link_message").foundation(
                                  "toggle"
                              ),
                              a(".q2-external-return")
                                  .focus()
                                  .removeClass("q2-external-return");
                      })
                    : ((e = a("#q2_external_link_message")).remove(),
                      a("body").append(e),
                      e.removeClass("reveal"),
                      e.removeAttr("data-reveal"),
                      e.attr("role", "dialog"),
                      e.attr("aria-hidden", "true"),
                      e.addClass("q2-external-modal"),
                      e
                          .addClass("q2-external-modal")
                          .wrap(
                              '<div class="q2-external-modal-overlay"></div>'
                          ),
                      a(
                          "#q2_external_link_message .button.q2-external-link-cancel"
                      ).keydown(function (e) {
                          "Tab" === e.key &&
                              setTimeout(function () {
                                  a(
                                      "#q2_external_link_message .button.q2-external-link-continue"
                                  ).focus();
                              }, 0);
                      }),
                      a(
                          "#q2_external_link_message .button.q2-external-link-continue"
                      ).keydown(function (e) {
                          "Tab" === e.key &&
                              (e.preventDefault(),
                              setTimeout(function () {
                                  a(
                                      "#q2_external_link_message .button.q2-external-link-cancel"
                                  ).focus();
                              }, 0));
                      }),
                      a(
                          "#q2_external_link_message .button.q2-external-link-cancel, #q2_external_link_message .button.q2-external-link-continue"
                      ).keydown(function (e) {
                          ("Escape" != e.key && "Esc" != e.key) ||
                              (e.preventDefault(),
                              window.q2.externalLinks.hideModal());
                      }),
                      a(
                          "#q2_external_link_message .button.q2-external-link-cancel, .q2-external-modal-overlay"
                      ).on("click", function (e) {
                          e.target === e.currentTarget &&
                              (e.preventDefault(),
                              window.q2.externalLinks.hideModal());
                      }));
            },
            checkLink: function (e) {
                var t,
                    n = drupalSettings.q2_external_link_whitelist;
                e[0].hostname &&
                    location.hostname !== e[0].hostname &&
                    ((t = e),
                    n.length
                        ? a.each(n, function () {
                              var e = new RegExp(
                                      this.replace("?", "_QUEST_MARK_")
                                          .replace("+", "_PLUS_")
                                          .replace("*", "_ASTERISK_")
                                          .replace(":", "_COLON_")
                                  ),
                                  n = t
                                      .attr("href")
                                      .replace("?", "_QUEST_MARK_")
                                      .replace("+", "_PLUS_")
                                      .replace("*", "_ASTERISK_")
                                      .replace(":", "_COLON_");
                              if (!1 !== e.test(n))
                                  return t.removeClass("q2-external"), !1;
                              t.addClass("q2-external");
                          })
                        : t.addClass("q2-external"),
                    t.hasClass("q2-external") &&
                        window.q2.externalLinks.linkWatcher(t));
            },
            linkWatcher: function (e) {
                this.hasFoundation()
                    ? e.on("click", function (e) {
                          e.preventDefault(),
                              a(this).addClass("q2-external-return");
                          e = a(this).closest("a").attr("href");
                          a(
                              "#q2_external_link_message .q2-external-link-url"
                          ).text(e),
                              a(
                                  "#q2_external_link_message .q2-external-link-continue"
                              ).attr("href", e),
                              a("#q2_external_link_message").foundation(
                                  "toggle"
                              );
                      })
                    : e.on("click", function (e) {
                          e.preventDefault(),
                              window.q2.externalLinks.showModal(a(this));
                      });
            },
            init: function () {
                a("a").each(function () {
                    window.q2.externalLinks.checkLink(a(this));
                }),
                    this.setupModal();
            },
        }),
            setTimeout(function () {
                window.q2.externalLinks.init();
            }, 50);
    });
});
